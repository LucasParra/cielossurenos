(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[11],{650:function(e,t,n){"use strict";n.d(t,"g",(function(){return d})),n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return b})),n.d(t,"d",(function(){return m})),n.d(t,"j",(function(){return l})),n.d(t,"r",(function(){return D})),n.d(t,"s",(function(){return O})),n.d(t,"p",(function(){return I})),n.d(t,"i",(function(){return p})),n.d(t,"h",(function(){return h})),n.d(t,"e",(function(){return x})),n.d(t,"f",(function(){return C})),n.d(t,"c",(function(){return v})),n.d(t,"q",(function(){return U})),n.d(t,"m",(function(){return g})),n.d(t,"k",(function(){return T})),n.d(t,"o",(function(){return y})),n.d(t,"n",(function(){return q})),n.d(t,"l",(function(){return k}));var r=n(23),c=n(653),o=n.n(c),u=n(51),a=n(667),s=n(660),i=n(654),f=n(657),d=function(){return u.supabase.from("User").select("*").eq("RolID",1).then((function(e){return e.data})).catch(console.error)},l=function(e){return u.supabase.from("User").select("*").eq("Rut",e).then((function(e){return e.data})).catch(console.error)},h=function(e){return u.supabase.from("User").select("*,RolID(*),ZoneID:UserAddress(AddressID(AddressZoneID))").eq("Email",e).then((function(e){return e.data})).catch(console.error)},j=function(e){return u.supabase.from("User").insert(e).then((function(e){return e.data[0].ID}))},b=function(e){return u.supabase.from("UserAddress").insert(e).then((function(e){return e.data[0].ID}))},m=function(e){return u.supabase.from("UserProduct").insert(e).then((function(e){return e.data[0].ID}))},D=function(e){return u.supabase.from("User").update(e).eq("ID",e.ID)},I=function(e){return u.supabase.from("UserAddress").update(e).eq("ID",e.ID)},O=function(e){return u.supabase.from("UserProduct").update(e).eq("ID",e.ID)},p=function(e){return u.supabase.from("User").select("*,UserAddress!inner(Address(*,AddressZoneID(*)))").eq("ID",e).then((function(e){return e.data[0]})).catch(console.error)},g=function(e,t){return u.supabase.from("User").select("*").eq("RolID",2).ilike("Rut","%".concat(t,"%")).limit(5*e+1).then((function(e){return e.data})).catch(console.error)},x=function(e,t){return u.supabase.from("User").select("*",{count:"exact"}).eq("RolID",2).eq("StateID",e).then((function(n){return{count:n.count,name:t,stateID:e}})).catch(console.error)},C=function(e,t){return u.supabase.from("OfficeUser").select("User!inner(*),Office!inner(*)",{count:"exact"}).eq("User.RolID",2).eq("User.StateID",t).eq("Office.ID",e).then((function(e){return e.count})).catch(console.error)},v=function(e,t,n,c){j(e).then((function(o){Promise.all([t.map((function(e){return m(Object(r.a)(Object(r.a)({},e),{},{UserID:o}))})),Object(i.b)({TypeID:1,AssignedID:e.TechnicianID,ClientID:o}),Object(s.a)(o,c),n.map((function(e){return Object(a.a)(e).then((function(e){b({AddressID:e,UserID:o})}))}))])}))},U=function(e,t,n,c){return D(e).then((function(){Promise.all([t.map((function(t){return t.ID?O(Object(r.a)(Object(r.a)({},t),{},{UserID:e.ID})):m(Object(r.a)(Object(r.a)({},t),{},{UserID:e.ID}))})),Object(s.g)(e.ID,c),n.map((function(t){return t.ID?Object(a.c)(t).then((function(t){I({AddressID:t,UserID:e.ID})})):Object(a.a)(t).then((function(t){b({AddressID:t,UserID:e.ID})}))}))])}))},T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return u.supabase.from("User").select("*,Address(*)").or("Names.ilike.%".concat(e,"%,LastName.ilike.%").concat(e,"%,Rut.ilike.%").concat(e,"%")).eq("RolID",2).limit(5*t+1).then((function(e){return e.data})).catch(console.error)},y=function(e,t){return Object(f.d)(t).then((function(t){var n=t[o.a.random(0,t.length-1)];D({ID:e,StateID:5}).then((function(){Object(i.b)({TypeID:16,AssignedID:n.User.ID,ClientID:e,StateID:3})}))}))},q=function(e,t){return Object(f.d)(t).then((function(t){var n=t[o.a.random(0,t.length-1)];D({ID:e,StateID:6}).then((function(){Object(i.b)({TypeID:17,AssignedID:n.User.ID,ClientID:e,StateID:3})}))}))},k=function(){return u.supabase.from("UserState").select("*").then((function(e){return e.data})).catch(console.error)}},654:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"j",(function(){return a})),n.d(t,"i",(function(){return s})),n.d(t,"k",(function(){return i})),n.d(t,"g",(function(){return f})),n.d(t,"d",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return j})),n.d(t,"a",(function(){return b})),n.d(t,"h",(function(){return m}));var r=n(23),c=n(657),o=n(51).supabase,u=function(e){return o.from("Task").insert(Object(r.a)(Object(r.a)({},e),{},{Priority:"Media"})).then((function(e){return console.log(e)}))},a=function(){return o.from("TaskType").select("*").then((function(e){return e.data}))},s=function(e){return o.from("Task").select("*,TypeID(Name)").order("ID",{ascending:!1}).eq("ClientID",e).then((function(e){return e.data})).catch(console.error)},i=function(e){return o.from("Task").update(e).eq("ID",e.ID)},f=function(e){return o.from("Task").select("*").order("ID",{ascending:!1}).eq("ClientID",e).or("StateID.eq.1,StateID.eq.3,TypeID.eq.4").then((function(e){return e.data})).catch(console.error)},d=function(e){return o.from("Task").update({StateID:2}).eq("ID",e).then((function(e){return e.data[0].ID}))},l=function(e){return o.from("Task").update({StateID:2}).eq("StateID",3).eq("ClientID.ID",e).eq("TypeID.ID",16).then((function(e){return e.data}))},h=function(e,t){return Object(c.c)(e).then((function(e){return u(Object(r.a)(Object(r.a)({},t),{},{AssignedID:e[0].User.ID,StateID:3}))}))},j=function(e){return o.from("TaskComments").select("*,UserID(Names,LastName)").eq("TaskID",e).then((function(e){return e.data}))},b=function(e){return o.from("TaskComments").insert(e).then((function(e){var t;return null===e||void 0===e||null===(t=e.data[0])||void 0===t?void 0:t.ID}))},m=function(){return o.from("TaskState").select("*,Task!inner(*)").then((function(e){return e.data}))}},656:function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return u}));var r=n(51),c=function(e){return r.supabase.from("Product").select("*").limit(5*e+1).then((function(e){return e.data})).catch(console.error)},o=function(e){return r.supabase.from("UserProduct").select("*,ProductID(*)").eq("UserID",e).then((function(e){return e.data})).catch(console.error)},u=function(e){return r.supabase.from("UserProduct").select("*",{count:"exact"}).eq("ProductID",e).then((function(e){return e.count}))}},657:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"f",(function(){return o})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n(51).supabase,c=function(e){return r.from("Zones").insert(e).then((function(e){return e.data[0].ID}))},o=function(e,t){return r.from("Zones").update(t).eq("ID",e)},u=function(){return r.from("Zones").select("*").then((function(e){return e.data})).catch(console.error)},a=function(e){return r.from("UserAddress").select("User!inner(*),Address!inner(*)").eq("User.RolID",8).eq("Address.AddressZoneID",e).then((function(e){return e.data})).catch(console.error)},s=function(e){return r.from("UserAddress").select("User!inner(*),Address!inner(*)").eq("User.RolID",1).eq("Address.AddressZoneID",e).then((function(e){return e.data})).catch(console.error)},i=function(e){return r.from("UserAddress").select("User!inner(*),Address!inner(*)").eq("User.RolID",2).ilike("Address.AddressName","%".concat(e,"%")).then((function(e){return e.data})).catch(console.error)}},658:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return s})),n.d(t,"l",(function(){return i})),n.d(t,"a",(function(){return f})),n.d(t,"i",(function(){return d})),n.d(t,"h",(function(){return l})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return j})),n.d(t,"m",(function(){return m})),n.d(t,"k",(function(){return b})),n.d(t,"j",(function(){return u})),n.d(t,"g",(function(){return D})),n.d(t,"b",(function(){return I}));var r=n(655),c=n.n(r),o=n(51).supabase,u=function(e){return o.from("ChargeType").select("*").limit(5*e+1).then((function(e){return e.data})).catch(console.error)},a=function(e){return o.from("Charge").insert(e).then((function(e){return e.data})).catch(console.error)},s=function(e){return o.from("Charge").delete().match({ID:e}).then((function(e){return e.data}))},i=function(e,t){return o.from("Charge").update(e).eq("ID",t).then((function(e){return e.data})).catch(console.error)},f=function(){return o.from("User").select("*").eq("RolID",2).then((function(e){e.data.map((function(e){return o.from("UserProduct").select("Product(*),ID,Price").eq("UserID",e.ID).then((function(t){var n=t.data;return 0===n.length?null:a({ChargeTypeID:7,CreatedAt:c()().toDate(),Charge:n.reduce((function(e,t){return e+t.Product.BasePrice}),0),ClientID:e.ID,State:!1,Remaining:0})}))}))})).catch(console.error)},d=function(e){return o.from("Charge").select("*,ChargeTypeID(*)").eq("ClientID",e).eq("State",!1).then((function(e){return e.data}))},l=function(e){return o.from("Charge").select("*,ChargeTypeID(*)").eq("ClientID",e).order("CreatedAt",{ascending:!0}).then((function(e){return e.data}))},h=function(e,t,n){return o.from("Charge").update({State:!0,UrlImage:t,DocumentID:n.id,UrlDocument:n.urlPublicView}).eq("ID",e).then((function(e){return e.data}))},j=function(e){return o.from("ChargeType").insert(e).then((function(e){return e.data})).catch(console.error)},b=function(){return o.from("ChargeType").select("*").then((function(e){return e.data})).catch(console.error)},m=function(e,t){return o.from("ChargeType").update(t).eq("ID",e)},D=function(e){return o.from("ChargeType").delete().match({ID:e}).then((function(e){return e.data}))},I=function(e){return o.from("Charge").select("*",{count:"exact"}).eq("ChargeTypeID",e).then((function(e){return e.count}))}},660:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"g",(function(){return u})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return f}));var r=n(51).supabase,c=function(e){return r.from("Office").insert(e).then((function(e){return e.data[0].ID}))},o=function(e,t){return r.from("Office").update(t).eq("ID",e)},u=function(e,t){return r.from("OfficeUser").update({OfficeID:t}).eq("UserID",e).then((function(e){return e.data})).catch(console.error)},a=function(e,t){return r.from("OfficeUser").insert({OfficeID:t,UserID:e}).then((function(e){return e.data[0].ID}))},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return r.from("Office").select("*").limit(5*e+1).then((function(e){return e.data}))},i=function(e){return r.from("OfficeUser").select("*,OfficeID(*)").eq("UserID",e).then((function(e){return e.data[0]}))},f=function(e){return r.from("Office").delete().match({ID:e})}},661:function(e,t,n){"use strict";var r=n(23),c=n(91),o=n(2),u=n(646),a=n(650),s=n(17);t.a=function(e){var t=e.setTechnicianID,n=e.TechnicianID,i=e.isAllData,f=Object(o.useState)([]),d=Object(c.a)(f,2),l=d[0],h=d[1],j=Object(o.useState)(!1),b=Object(c.a)(j,2),m=b[0],D=b[1],I=function(){D(!0),Object(a.g)().then((function(e){h(e.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{nombre:e.Names,apellido:e.LastName})}))),D(!1)}))};return Object(o.useEffect)(I,[]),Object(s.jsx)(u.y,{items:l,fields:["nombre","apellido","opciones"],itemsPerPage:5,onPageChange:I,loading:m,pagination:!0,scopedSlots:{opciones:function(e){return Object(s.jsx)("td",{className:"py-2",children:Object(s.jsx)(u.tb,{className:"align-items-center",children:Object(s.jsx)(u.u,{col:"2",xs:"2",sm:"2",md:"2",className:"mb-2 mb-xl-0",children:Object(s.jsx)(u.Cb,{className:"mx-1",variant:"3d",color:"success",value:i?(null===n||void 0===n?void 0:n.ID)===e.ID:n===e.ID,checked:i?(null===n||void 0===n?void 0:n.ID)===e.ID:n===e.ID,onChange:function(){return t(i?e:e.ID)}})})},e.ID)})}}})}},667:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return o}));var r=n(51),c=function(e){return r.supabase.from("Address").insert(e).then((function(e){return e.data[0].ID}))},o=function(e){return r.supabase.from("Address").update(e).eq("ID",e.ID)},u=function(e){return r.supabase.from("UserAddress").select("*,Address (*)").eq("UserID",e).then((function(e){return e.data})).catch(console.error)}},673:function(e,t){function n(e){return"string"===typeof e?e.replace(/^0+|[^0-9kK]+/g,"").toUpperCase():""}e.exports={validate:function(e){if("string"!==typeof e)return!1;if(/^0+/.test(e))return!1;if(!/^0*(\d{1,3}(\.?\d{3})*)-?([\dkK])$/.test(e))return!1;e=n(e);for(var t=parseInt(e.slice(0,-1),10),r=0,c=1;t>0;)c=(c+t%10*(9-r++%6))%11,t=Math.floor(t/10);return(c>0?""+(c-1):"K")===e.slice(-1)},clean:n,format:function(e){for(var t=(e=n(e)).slice(-4,-1)+"-"+e.substr(e.length-1),r=4;r<e.length;r+=3)t=e.slice(-3-r,-r)+"."+t;return t},getCheckDigit:function(e){var t=Array.from(n(e),Number);if(0===t.length||t.includes(NaN))throw new Error('"'.concat(e,'" as RUT is invalid'));var r=11-t.reverse().reduce((function(e,t,n){return e+t*(n%6+2)}),0)%11;return 10===r?"K":11===r?"0":r.toString()}}},769:function(e,t,n){"use strict";n.r(t);var r=n(91),c=n(2),o=n(646),u=n(649),a=n(673),s=n(650),i=n(23),f=n(655),d=n.n(f),l=n(654),h=n(661),j=n(17),b=function(e){var t=e.goBack,n=e.user,u=e.charges,a=e.tasks,s=e.products,f=Object(c.useState)("Charges"),b=Object(r.a)(f,2),m=b[0],D=b[1],I=Object(c.useState)([]),O=Object(r.a)(I,2),p=O[0],g=O[1],x=Object(c.useState)(!1),C=Object(r.a)(x,2),v=C[0],U=C[1],T=Object(c.useState)({TypeID:"",AssignedID:"",ClientID:n.ID,Note:"",StateID:1}),y=Object(r.a)(T,2),q=y[0],k=y[1],N=function(){Object(l.j)().then(g)};return Object(c.useEffect)(N,[]),Object(j.jsxs)(o.w,{children:[Object(j.jsxs)(o.tb,{className:"justify-content-center",children:[Object(j.jsxs)(o.u,{md:"12",children:[Object(j.jsx)(o.f,{color:"info",onClick:t,children:"Volver"}),Object(j.jsx)("span",{className:"clearfix",children:Object(j.jsx)("h4",{className:"pt-3",children:"".concat(null===n||void 0===n?void 0:n.Names," ").concat(null===n||void 0===n?void 0:n.LastName)})})]}),Object(j.jsx)(o.u,{md:"3",children:Object(j.jsxs)(o.bb,{children:[Object(j.jsx)(o.cb,{component:"button",active:"Charges"===m,style:{cursor:"pointer"},onClick:function(){return D("Charges")},children:"Deudas"}),Object(j.jsx)(o.cb,{component:"button",active:"Payment"===m,style:{cursor:"pointer"},onClick:function(){return D("Payment")},children:"Ultimos Pagos"}),0!==s.length&&Object(j.jsx)(o.cb,{component:"button",active:"Tasks"===m,style:{cursor:"pointer"},onClick:function(){return D("Tasks")},children:"Estado de Tarea de tecnico"}),Object(j.jsx)(o.cb,{component:"button",active:"Products"===m,style:{cursor:"pointer"},onClick:function(){return D("Products")},children:"Productos Contratados"}),Object(j.jsx)(o.cb,{component:"button",active:"CreateTask"===m,style:{cursor:"pointer"},onClick:function(){return D("CreateTask")},children:"Crear Tareas"})]})}),Object(j.jsx)(o.u,{children:Object(j.jsx)(o.j,{children:Object(j.jsxs)(o.k,{children:[("Charges"===m||"Payment"===m)&&Object(j.jsxs)(j.Fragment,{children:[u.filter((function(e){return"Charges"===m?!e.State:e.State})).map((function(e){return Object(j.jsx)(o.i,{color:"Charges"===m?"danger":"success",children:Object(j.jsxs)("span",{className:"clearfix",children:[Object(j.jsx)("h4",{className:"pt-1",children:"".concat(new Intl.NumberFormat("es-CL",{currency:"CLP",style:"currency"}).format(e.Charge))}),Object(j.jsx)("h3",{className:"pt-1",children:"".concat(e.ChargeTypeID.Name)}),Object(j.jsx)("h5",{className:"pt-1",children:"Fecha : ".concat(d()(e.CreatedAt).format("DD-MM-YYYY"))})]})},e.ID)})),0===u.filter((function(e){return"Charges"===m?!e.State:e.State})).length&&Object(j.jsx)("h4",{className:"pt-1",children:"Est\xe1s al d\xeda"})]}),"Tasks"===m&&a.filter((function(e){return 3!==e.StateID})).map((function(e){return Object(j.jsx)(o.i,{color:1===e.StateID?"info":"success",children:Object(j.jsxs)("span",{className:"clearfix",children:[Object(j.jsx)("h4",{className:"pt-1",children:"".concat(e.TypeID.Name)}),Object(j.jsx)("h3",{className:"pt-1",children:" Estado : ".concat(1===e.StateID?"Pendiente":"Finalizada")}),Object(j.jsx)("h5",{className:"pt-1",children:" ID : ".concat(e.ID)})]})},e.ID)})),"Products"===m&&s.map((function(e){return Object(j.jsx)(o.i,{color:"info",children:Object(j.jsx)("span",{className:"clearfix",children:Object(j.jsx)("h4",{className:"pt-1",children:"".concat(e.ProductID.Name)})})},e.ID)})),"CreateTask"===m&&Object(j.jsxs)(o.tb,{children:[Object(j.jsxs)(o.u,{xs:"3",lg:"3",children:[Object(j.jsx)("h4",{children:"Tipo"}),Object(j.jsxs)(o.ub,{custom:!0,size:"xl",name:"DiscountType",id:"DiscountType",value:q.TypeID,onChange:function(e){var t=e.target.value;return k(Object(i.a)(Object(i.a)({},q),{},{TypeID:parseInt(t)}))},children:[Object(j.jsx)("option",{value:"",children:"selecciona un tipo"}),p.filter((function(e){return e.ID<6})).map((function(e){return Object(j.jsx)("option",{value:e.ID,children:e.Name},e.ID)}))]})]}),Object(j.jsxs)(o.u,{xs:"3",lg:"3",children:[Object(j.jsx)("h4",{children:"Tecnico Encargado"}),Object(j.jsx)(o.f,{color:"info",onClick:function(){return U(!0)},style:{marginBottom:10},children:"Tecnico"})]}),Object(j.jsxs)(o.u,{xs:"3",lg:"3",children:[Object(j.jsx)("h4",{children:"Nota (Opcional)"}),Object(j.jsx)(o.Gb,{id:"name",value:q.Note,onChange:function(e){var t=e.target.value;return k(Object(i.a)(Object(i.a)({},q),{},{Note:t}))}})]}),Object(j.jsx)(o.u,{xs:"3",lg:"3",style:{paddingTop:10},children:Object(j.jsx)(o.f,{color:"success",onClick:function(){return Object(l.b)(q).then((function(){k({TypeID:"",AssignedID:"",ClientID:"",Note:"",StateID:4}),N()}))},style:{marginBottom:10},children:"Crear"})})]})]})})})]}),Object(j.jsxs)(o.db,{show:v,onClose:U,color:"info",children:[Object(j.jsx)(o.gb,{closeButton:!0,children:Object(j.jsx)(o.hb,{children:"Selecciona el tecnico encargado"})}),Object(j.jsx)(o.eb,{children:Object(j.jsx)(h.a,{setTechnicianID:function(e){return k(Object(i.a)(Object(i.a)({},q),{},{AssignedID:e}))},TechnicianID:q.AssignedID})}),Object(j.jsx)(o.fb,{children:Object(j.jsx)(o.f,{color:"info",onClick:function(){return U(!1)},children:"Aceptar"})})]})]})},m=n(658),D=n(656);t.default=function(){var e=Object(c.useState)(""),t=Object(r.a)(e,2),n=t[0],i=t[1],f=Object(c.useState)({}),d=Object(r.a)(f,2),h=d[0],I=d[1],O=Object(c.useState)("search"),p=Object(r.a)(O,2),g=p[0],x=p[1],C=Object(c.useState)([]),v=Object(r.a)(C,2),U=v[0],T=v[1],y=Object(c.useState)([]),q=Object(r.a)(y,2),k=q[0],N=q[1],A=Object(c.useState)([]),S=Object(r.a)(A,2),P=S[0],R=S[1];return Object(j.jsx)("div",{className:"c-app c-default-layout flex-row align-items-center",children:Object(j.jsx)(o.w,{children:Object(j.jsx)(o.tb,{className:"justify-content-center",children:"search"===g?Object(j.jsxs)(o.u,{md:"6",children:[Object(j.jsx)("span",{className:"clearfix",children:Object(j.jsx)("h1",{className:"display-3",style:{textAlign:"center"},children:"bienvenido"})}),Object(j.jsxs)(o.S,{className:"input-prepend",children:[Object(j.jsx)(o.U,{children:Object(j.jsx)(o.V,{children:Object(j.jsx)(u.a,{name:"cil-magnifying-glass"})})}),Object(j.jsx)(o.P,{size:"16",type:"text",value:Object(a.format)(n),maxLength:12,onChange:function(e){var t=e.target.value;return i(t)}}),Object(j.jsx)(o.T,{children:Object(j.jsx)(o.f,{color:"info",onClick:function(){Object(s.j)("".concat(Object(a.clean)(n).substr(0,Object(a.clean)(n).length-1),"-").concat(Object(a.clean)(n).substr(Object(a.clean)(n).substr(0,Object(a.clean)(n).length-1).length,Object(a.clean)(n).length-1))).then((function(e){var t;I(e[0]);var n=null===(t=e[0])||void 0===t?void 0:t.ID;if(console.log("id del usuario es :",n),!n)return null;Promise.all([Object(m.h)(n),Object(l.i)(n),Object(D.b)(n)]).then((function(e){T(e[0]),N(e[1]),R(e[2])})),x("user")}))},children:"Ingresar"})})]})]}):Object(j.jsx)(b,{goBack:function(){i(""),x("search")},user:h,charges:U,tasks:k,products:P})})})})}}}]);
//# sourceMappingURL=11.12dd46dc.chunk.js.map